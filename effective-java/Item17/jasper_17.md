## Item 17

> 변경 가능성을 최소화하라

### 불변 클래스란?

- 인스턴스의 내부 값을 수정할 수 없는 클래스.

- 불변 인스턴스에 간직된 정보는 고정되어 객체가 파괴되는 순간까지 절대 달라지지 않는다.

- 자바 라이브러리에서의 불변 클래스는 String, 기본 타입의 박싱 클래스, BigInteger, BigDecimal 등이 있다.

- 불변 클래스는 가변 클래스보다 설계하고 구현하고 사용하기 쉬우며, 오류가 생길 여지도 적고 훨씬 안전하다.

### 불변 클래스 설계 규칙

- 객체의 상태를 변경하는 메서드(변경자)를 제공하지 않는다.

- 클래스를 확장할 수 없도록 한다.

- 모든 필드를 final로 선언한다.

- 모든 필드를 private으로 선언한다.

- 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.

### 불변 객체의 장점

- 불변 객체는 단순하다. 생성된 시점의 상태를 파괴될 때까지 그대로 간직한다.

    - 반면, 가변 객체는 임의 복잡한 상태에 놓일 수 있다. 변경자 메서드가 일으키는 상태 전이를 정밀하게 문서로 남겨놓지 않은 가변 클래스는 믿고 사용하기 어려울 수도 있다.

- 불변 객체는 근본적으로 쓰레드 안전하여 따로 동기화할 필요 없다.

    - 안심하고 공유할 수 있다.

- 불변 클래스라면 한번 만든 인스턴스를 최대한 재활용하자.

    - 자주 쓰이는 값들을 상수(public static final)로 제공.

    - 불변 클래스는 자주 사용되는 인스턴스를 캐싱하여 같은 인스턴스를 중복 생성하지 않게 해주는 정적 팩터리를 제공할 수 있다.

- 객체를 만들 때 다른 불변 객체들을 구성요소로 사용하여 이점을 얻을 수 있다.

- 불변 객체는 그 자체로 실패 원자성을 제공 한다.

### 불변 객체의 단점

- 값이 다르면 반드시 독립된 객체로 만들어야 한다.

    - 값의 가짓수가 많다면 이들을 모두 만드는 데 큰 비용을 치러야 한다.

### 정리

- 게터(getter)가 있다고 해서 무조건 세터(setter)를 만들지는 말자.

- 클래스는 꼭 필요한 경우가 아니라면 불변이어야 한다.

- 불변 클래스는 장점이 많으며, 단점이라곤 특정 상황에서의 잠재적 성능 저하 뿐이다.

- 값 객체는 항상 불변으로 만들자.

- 성능 때문에 어쩔 수 없다면 불변 클래스와 쌍을 이루는 가변 동반 클래스를 public 클래스로 제공하도록 하자.

- 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄이자.

